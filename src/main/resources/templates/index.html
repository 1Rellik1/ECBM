<html lang="ru">
<head>
    <meta charSet="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Тракторный завод</title>
    <link rel="stylesheet" type="text/css" href="css/style_auto.css"/>
    <link rel="stylesheet" type="text/css" href="css/style_admin.css"/>
    <link rel="stylesheet" type="text/css" href="css/style_mon.css"/>
    <link rel="stylesheet" type="text/css" href="css/style_prohibit.css"/>
    <link rel="preconnect" type="text/css" href="https://fonts.googleapis.com">
    <link rel="preconnect" type="text/css" href="https://fonts.gstatic.com" crossOrigin>
    <link type="text/css"
          href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <script lang="JavaScript">
        let xhr_name
        let nickName


        let objForAdminEdit
        let spanForAdminEdit
        let objForMonEdit = ['', '', '', '', '', '']
        let objForMonHistory
        let timerTablo
        let numberOfListalka
        let xhr
        let countIncident

        let xhr_access
        let access


        window.addEventListener('load', function () {
            new Promise((resolve, reject) => {
                xhr_name = new XMLHttpRequest()
                xhr_name.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getusername');
                xhr_name.addEventListener('load', () => {
                    resolve(xhr_name.response)
                })
                xhr_name.addEventListener('error', () => {
                    reject()
                })
                xhr_name.send()
            }).then(text => {
                nickName = text
                return new Promise((resolve, reject) => {
                    xhr_access = new XMLHttpRequest()
                    xhr_access.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getuseraccess');
                    xhr_access.addEventListener('load', () => {
                        resolve(xhr_access.response)
                    })
                    xhr_access.addEventListener('error', () => {
                        reject()
                    })
                    xhr_access.send()
                })
            }).then(text => {
                access = text
                let page = sessionStorage.getItem('page')
                if (page) {
                    if (page == 'adm') {
                        document.title = 'Администрирование'
                        goToAdmin()
                    }
                    if (page == 'access') {
                        document.title = 'Нет доступа'
                        goToProhibit()
                    }
                    if (page == 'adm/edit') {
                        document.title = 'Редактирование пользователя'
                        goToAdminEdit()
                        let span = document.createElement('span')
                        span.style.display = 'none'
                        span.classList.add('spann')
                        span.textContent = sessionStorage.getItem('spanForAdminEdit')
                        document.body.appendChild(span)
                        let access = sessionStorage.getItem('adminAccesslist')
                        enter_enter.value = sessionStorage.getItem('adminName')
                        let settings = document.body.getElementsByClassName('small_quadro')
                        let acc = access.length
                        for (let j = 0; j < acc; j++) {
                            if (access[j] == '1') {
                                settings[j].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                                settings[j].flag = 1
                            }
                        }
                        if (access[1] == '1' && access[2] == '1') {
                            settings[1].style.opacity = '50%'
                        }
                    }
                    if (page == 'adm/create') {
                        document.title = 'Создание пользователя'
                        goToAdminCreate()
                    }
                    if (page == 'mon') {
                        document.title = 'Мониторинг'
                        goToMonitoring()
                    }
                    if (page == 'mon/edit') {
                        document.title = 'Редактирование происшествия'
                        goToMonitoringEdit()
                        let inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                        let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                        let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                        let inp4 = document.body.getElementsByClassName('inp3')[0]
                        let span = document.createElement('span')
                        span.classList.add('spann')
                        span.textContent = sessionStorage.getItem('idI')
                        span.style.display = "none"
                        document.body.appendChild(span)
                        inp1.textContent = sessionStorage.getItem('postI')
                        inp2.textContent = sessionStorage.getItem('timeI')
                        inp3.textContent = sessionStorage.getItem('timeDoneI')
                        inp4.value = sessionStorage.getItem('descriptionI')
                        let type = document.body.getElementsByClassName('inp2')[0].children
                        let flag = 0
                        for (let i = 0; i < 4; i++) {
                            if (sessionStorage.getItem('typeI') == type[i].textContent) {
                                type[i].style.background = 'black'
                                type[i].style.color = 'white'
                                flag = 1
                            }
                        }
                    }
                    if (page == 'mon/history') {
                        document.title = 'История происшествия'
                        goToMonitoringHistory(sessionStorage.getItem('monHistory'))
                    }
                } else {
                    document.title = 'Мониторинг'
                    goToMonitoring()
                    history.pushState({}, '', '#mon')
                }
            })
        })

        window.addEventListener('popstate', function () {
            if (location.hash == '#adm') {
                document.title = 'Администрирование'
                goToAdmin()
            }
            if (location.hash == '#access') {
                document.title = 'Нет доступа'
                goToProhibit()
            }
            if (location.hash == '#adm/edit') {
                document.title = 'Редактирование пользователя'
                goToAdminEdit()
                let span = document.createElement('span')
                span.style.display = 'none'
                span.classList.add('spann')
                span.textContent = sessionStorage.getItem('spanForAdminEdit')
                document.body.appendChild(span)
                let access = sessionStorage.getItem('adminAccesslist')
                enter_enter.value = sessionStorage.getItem('adminName')
                let settings = document.body.getElementsByClassName('small_quadro')
                let acc = access.length
                for (let j = 0; j < acc; j++) {
                    if (access[j] == '1') {
                        settings[j].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                        settings[j].flag = 1
                    }
                }
                if (access[1] == '1' && access[2] == '1') {
                    settings[1].style.opacity = '50%'
                }


                /*document.title = 'Редактирование пользователя'
                goToAdminEdit()
                document.body.appendChild(spanForAdminEdit)
                let main = objForAdminEdit
                enter_enter.value = main.name
                let settings = document.body.getElementsByClassName('small_quadro')
                console.log(main)
                let acc = main.accesslist.length
                for (let j = 0; j < acc; j++) {
                    if (main.accesslist[j] == '1'){
                        settings[j].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                        settings[j].flag = 1
                    }
                }
                if(main.accesslist[1] == '1' && main.accesslist[2] == '1'){
                    settings[1].style.opacity = '50%'
                }*/
            }
            if (location.hash == '#adm/create') {
                document.title = 'Создание пользователя'
                goToAdminCreate()
            }
            if (location.hash == '#mon') {
                document.title = 'Мониторинг'
                goToMonitoring()
            }
            if (location.hash == '#mon/edit') {
                document.title = 'Редактирование происшествия'
                goToMonitoringEdit()
                let inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                let inp4 = document.body.getElementsByClassName('inp3')[0]
                let span = document.createElement('span')
                span.classList.add('spann')
                span.textContent = sessionStorage.getItem('idI')
                span.style.display = "none"
                document.body.appendChild(span)
                inp1.textContent = sessionStorage.getItem('postI')
                inp2.textContent = sessionStorage.getItem('timeI')
                inp3.textContent = sessionStorage.getItem('timeDoneI')
                inp4.value = sessionStorage.getItem('descriptionI')
                let type = document.body.getElementsByClassName('inp2')[0].children
                let flag = 0
                for (let i = 0; i < 4; i++) {
                    if (sessionStorage.getItem('typeI') == type[i].textContent) {
                        type[i].style.background = 'black'
                        type[i].style.color = 'white'
                        flag = 1
                    }
                }


                /*document.title = 'Редактирование происшествия'
                goToMonitoringEdit()
                let inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                let inp4 = document.body.getElementsByClassName('inp3')[0]
                let span = document.createElement('span')
                span.classList.add('spann')
                span.textContent = objForMonEdit[5]
                span.style.display = "none"
                document.body.appendChild(span)
                inp1.textContent = objForMonEdit[4]
                inp2.textContent = objForMonEdit[2]
                inp3.textContent = objForMonEdit[3]
                inp4.value = objForMonEdit[1]
                let type = document.body.getElementsByClassName('inp2')[0].children
                let flag = 0
                for(let i = 0; i < 4; i++){
                    if(objForMonEdit[0] == type[i].textContent){
                        type[i].style.background = 'black'
                        type[i].style.color = 'white'
                        flag = 1
                    }
                }*/
            }
            if (location.hash == '#mon/history') {
                document.title = 'История происшествия'
                goToMonitoringHistory(sessionStorage.getItem('monHistory'))
            }
        })


        function delete_user_popup() {
            let popup = '<div class="delete_user_popup_back"><div class="delete_user_popup"></div></div>'
            document.body.innerHTML += popup
            let pop = document.body.getElementsByClassName('delete_user_popup')[0]
            let warning = document.createElement('div')
            warning.classList.add('warning')
            warning.innerText = 'Вы уверены что хотите удалить пользователя?'
            let butts = document.createElement('div')
            butts.classList.add('butts')
            let yes = document.createElement('div')
            yes.classList.add('yes')
            yes.innerText = 'Да'
            let no = document.createElement('div')
            no.classList.add('no')
            no.innerText = 'Нет'
            butts.appendChild(yes)
            butts.appendChild(no)
            pop.appendChild(warning)
            pop.appendChild(butts)
        }


        function goToProhibit() {
            sessionStorage.setItem('page', 'access')
            clearInterval(timerTablo)
            let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
            document.body.innerHTML = inner;
            name_logout.textContent = nickName
            admin.style.background = 'rgba(255, 255, 255, 0.66)';
            let main = document.createElement('div')
            let image = document.createElement('img')
            let text = document.createElement('div')
            main.appendChild(image)
            main.appendChild(text)
            image.src = 'images/no_access.png'
            main.classList.add('prohibit')
            text.textContent = 'У вас нет доступа к просмотру данной страницы, обратитесь к администратору.'
            document.body.appendChild(main)
            let but = document.createElement('div')
            but.classList.add('create_user')
            but.id = 'create_user'
            document.body.appendChild(but)
            but.textContent = 'Вернуться назад'
            but.style.margin = '0 auto'

            but.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }

            monitor.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }

            logout.addEventListener('click', function () {
                window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                sessionStorage.removeItem('page')
            })
        }


        function goToAdmin() {
            sessionStorage.setItem('page', 'adm')
            clearInterval(timerTablo)
            let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
            document.body.innerHTML = inner;
            name_logout.textContent = nickName

            let cur_menu = document.getElementById('admin');
            cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
            let monitor = document.getElementById('monitor');
            monitor.onmouseover = function () {
                monitor.style.background = 'rgba(255, 255, 255, 0.22)';
            }
            let name_menu = '<div class="name_menu">Управление доступом сотрудников</div>'
            document.body.innerHTML += name_menu;
            let horiz_line = '<div class="horiz_line"></div>'
            document.body.innerHTML += horiz_line;
            let user_nameANDcreate = '<div class="nameANDcreate"><div class="user_name">Имя пользователя</div><div name="create_user" id="create_user" className="create_user">Добавление нового пользователя</div></div>'
            document.body.innerHTML += user_nameANDcreate;
            var req
            new Promise((resolve, reject) => {
                req = new XMLHttpRequest()
                req.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getusers');
                req.addEventListener('load', () => {
                    resolve(req.response)
                })
                req.addEventListener('error', () => {
                    reject()
                })
                req.send()
            }).then(text => {
                let main = JSON.parse(text);
                let units = document.createElement('div')
                units.classList.add('units')
                document.body.appendChild(units)
                for (let i = 0; i < main.length; i++) {
                    let div = document.createElement('div')
                    units.appendChild(div);
                    div.classList.add('unit')
                }
                var div = document.body.getElementsByClassName('unit')
                for (let i = 0; i < div.length; i++) {
                    let username = document.createElement('div')
                    username.innerText = main[i].name
                    username.classList.add('username_unit')
                    let image1 = document.createElement('img')
                    let image2 = document.createElement('img')
                    let span = document.createElement('span')
                    span.textContent = main[i].id
                    span.style.display = 'none'
                    div[i].appendChild(span)
                    image1.src = 'images/green.png'
                    image2.src = 'images/red.png'
                    image1.classList.add('image_unit', 'green_edit')
                    image2.classList.add('image_unit', 'red_delete')
                    div[i].appendChild(username)
                    let green_red = document.createElement('div')
                    green_red.classList.add('green_red')
                    div[i].appendChild(green_red)
                    green_red.appendChild(image1)
                    green_red.appendChild(image2)
                }
                document.body.innerHTML += '<br><br><br><br><br>'

                logout.addEventListener('click', function () {
                    window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                    sessionStorage.removeItem('page')
                })

                let but_create_user = document.getElementById('create_user')
                let but_monitor = document.getElementById('monitor')
                but_monitor.onclick = () => {
                    goToMonitoring()
                    history.pushState({}, '', '#mon')
                    document.title = 'Мониторинг'
                }
                let but_deleteOrEdit_user = document.getElementsByClassName('units')[0]
                but_deleteOrEdit_user.addEventListener('click', function (event) {
                    let hime = this
                    if (event.target.classList.contains('green_edit')) {
                        console.log('редактирование')
                        let req8
                        new Promise((resolve, reject) => {
                            req8 = new XMLHttpRequest()
                            req8.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getuser');
                            req8.setRequestHeader("Content-Type", "application/json");
                            req8.addEventListener('load', () => {
                                resolve(req8.response)
                            })
                            req8.addEventListener('error', () => {
                                reject()
                            })
                            let id = event.target.parentNode.parentNode.querySelector('span').textContent
                            let data = JSON.stringify({"id": id});
                            req8.send(data)
                        }).then(text => {
                            let main = JSON.parse(text);
                            objForAdminEdit = main
                            let span = document.createElement('span')
                            span.textContent = event.target.parentNode.parentNode.querySelector('span').textContent
                            span.style.display = 'none'
                            span.classList.add('spann')
                            goToAdminEdit()
                            history.pushState({}, '', '#adm/edit')
                            document.title = 'Редактирование пользователя'
                            document.body.appendChild(span)
                            spanForAdminEdit = span
                            sessionStorage.setItem('spanForAdminEdit', span.textContent)
                            sessionStorage.setItem('adminName', main.name)
                            sessionStorage.setItem('adminAccesslist', main.accesslist)
                            enter_enter.value = main.name
                            let settings = document.body.getElementsByClassName('small_quadro')
                            console.log(main)
                            let acc = main.accesslist.length
                            for (let j = 0; j < acc; j++) {
                                if (main.accesslist[j] == '1') {
                                    settings[j].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                                    settings[j].flag = 1
                                }
                            }
                            if (main.accesslist[1] == '1' && main.accesslist[2] == '1') {
                                settings[1].style.opacity = '50%'
                            }
                        })
                    }

                    if (event.target.classList.contains('red_delete')) {
                        let that = event.target
                        let pop = document.querySelector('.delete_user_popup_back')
                        pop.style.display = 'flex'
                        let click_enter = function (e) {
                            if (e.key == 'Enter') {
                                document.body.getElementsByClassName('yes')[0].click()
                                window.removeEventListener('keydown', click_enter)
                            }
                        }
                        window.addEventListener('keydown', click_enter)
                        let click_esc = function (e) {
                            if (e.key == 'Escape') {
                                document.body.getElementsByClassName('no')[0].click()
                                window.removeEventListener('keydown', click_enter)
                            }
                        }
                        window.addEventListener('keydown', click_esc)
                        let yes = document.body.getElementsByClassName('yes')[0]
                        let no = document.body.getElementsByClassName('no')[0]
                        yes.onclick = () => {
                            for (let i = 0; i < that.parentNode.children.length; i++) {
                                if (that == that.parentNode.children[i]) {
                                    let xhr = new XMLHttpRequest();
                                    let url = location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + "deleteuser";
                                    xhr.open("DELETE", url, true);
                                    xhr.setRequestHeader("Content-Type", "application/json");
                                    xhr.onreadystatechange = function () {
                                        if (xhr.readyState === 4 && xhr.status === 200) {
                                            if (this.responseText)
                                                alert(this.responseText);
                                            if (this.responseText == 'Пользователь удален')
                                                hime.removeChild(that.parentNode.parentNode)
                                        }
                                    };
                                    var data = JSON.stringify({"id": event.target.parentNode.parentNode.querySelector('span').textContent});
                                    xhr.send(data);
                                }
                            }
                            pop.style.display = 'none'
                        }
                        no.onclick = () => {
                            pop.style.display = 'none'
                        }
                    }
                })
                but_create_user.onclick = function () {
                    goToAdminCreate()
                    history.pushState({}, '', '#adm/create')
                    document.title = 'Создание пользователя'
                }
            })
            delete_user_popup()
        }


        function goToAdminCreate() {
            sessionStorage.setItem('page', 'adm/create')
            clearInterval(timerTablo)
            let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
            document.body.innerHTML = inner;
            name_logout.textContent = nickName
            let cur_menu = document.getElementById('admin');
            cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
            let name_menu = '<div class="name_menu">Добавление пользователя</div>'
            document.body.innerHTML += name_menu;
            let horiz_line = '<div class="horiz_line"></div>'
            document.body.innerHTML += horiz_line;
            let enter_name1 = '<div class="enter_username"><div class="enter_main">Имя пользователя</div><input autocomplete="off" type="text" id="enter_enter" class="enter_enter"></div>'
            document.body.innerHTML += enter_name1;
            let enter_pass1 = '<div class="enter_password"><div class="enter_main">Пароль</div><input autocomplete="off" type="text" id="enter_pass" class="enter_enter"></div>'
            document.body.innerHTML += enter_pass1;
            enter_pass1 = '<div class="enter_password"><div class="enter_main">Повторите пароль</div><input autocomplete="off" type="text" id="enter_pass2" class="enter_enter"></div>'
            document.body.innerHTML += enter_pass1;
            let create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Управление доступом</div></div>'
            document.body.innerHTML += create_settings_user;
            create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Просмотр списка происшествий</div></div>'
            document.body.innerHTML += create_settings_user;
            create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Редактирование происшествий</div></div>'
            document.body.innerHTML += create_settings_user;
            let safe_button = '<a class="safe_button">Сохранить</a>'
            document.body.innerHTML += safe_button;
            let cancel_button = '<a class="cancel_button">Отмена</a>'
            document.body.innerHTML += cancel_button;
            var settings = document.body.getElementsByClassName('small_quadro')
            let func_flag = function () {
                if (this.flag == 0) {
                    this.style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    this.flag = 1
                } else {
                    this.style.background = 'white'
                    this.flag = 0
                }
            }
            for (let i = 0; i < 2; i++) {
                settings[i].flag = 0
                settings[i].addEventListener('click', func_flag)
            }
            let func_flag2 = function () {
                if (this.flag == 0) {
                    settings[1].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    settings[1].style.opacity = '50%'
                    settings[2].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    settings[1].flag = 1
                    this.flag = 1
                    settings[1].removeEventListener('click', func_flag)
                } else {
                    settings[1].style.opacity = '100%'
                    settings[2].style.background = 'white'
                    this.flag = 0
                    settings[1].addEventListener('click', func_flag)
                }
            }
            settings[2].flag = 0
            settings[2].addEventListener('click', func_flag2)

            /*-------------------------------------------------------------------------------------*/

            logout.addEventListener('click', function () {
                window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                sessionStorage.removeItem('page')
            })

            let but_create_user = document.getElementsByClassName('safe_button')[0]
            let but_cancel_create_user = document.getElementsByClassName('cancel_button')[0]
            let but_monitoring = document.getElementById('monitor')
            but_monitoring.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }
            admin.onclick = () => {
                goToAdmin()
                history.pushState({}, '', '#adm')
                document.title = 'Администрирование'
            }


            /*   НАЖАТИЕ КНОПКИ ОТМЕНА   */


            but_cancel_create_user.onclick = function () {
                console.log('Пользователь не создан')
                goToAdmin()
                history.pushState({}, '', '#adm')
                document.title = 'Администрирование'
            }


            /*   НАЖАТИЕ КНОПКИ СОХРАНИТЬ   */


            but_create_user.onclick = () => {

                let inm = document.getElementsByClassName('enter_username')[0]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }
                inm = document.getElementsByClassName('enter_password')[0]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }
                inm = document.getElementsByClassName('enter_password')[1]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }

                let settings = document.getElementsByClassName('small_quadro')
                if (!enter_enter.value || !enter_pass.value || enter_pass.value != enter_pass2.value || enter_enter.value.length > 30 || enter_pass.value.length > 30 || enter_pass2.value.length > 30) {
                    console.log('Данные не введены полностью')
                    if (enter_pass.value != enter_pass2.value) {
                        let inm = document.getElementsByClassName('enter_password')[0]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Пароли не совпали'

                    }
                    if (!enter_pass.value || !enter_pass2.value) {
                        let inm = document.getElementsByClassName('enter_password')[0]
                        if (!inm.children[2]) {
                            let er = document.createElement('div')
                            er.classList.add('mismatch')
                            inm.appendChild(er)
                            er.textContent = 'Пароль не введён'
                        }
                    }
                    if (enter_enter.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_username')[0]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Длина должна быть не больше 30 символов'

                    }
                    if (enter_pass.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_password')[1]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Длина должна быть не больше 30 символов'

                    }
                    if (enter_pass2.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_password')[1]
                        if (!inm.children[2]) {
                            let er = document.createElement('div')
                            er.classList.add('mismatch')
                            inm.appendChild(er)
                            er.textContent = 'Длина должна быть не больше 30 символов'
                        }
                    }
                } else {
                    console.log('Создан пользователь')
                    console.log('Имя: ', enter_enter.value)
                    console.log('Пароль: ', enter_pass.value)
                    let accesslist = ""
                    for (let i = 0; i < settings.length; i++) {
                        if (settings[i].style.backgroundImage == 'url("images/flag.png")') {
                            accesslist += 1
                        } else
                            accesslist += 0
                    }
                    console.log('Включены настройки: ', accesslist)
                    let xhr = new XMLHttpRequest();
                    let url = location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + "adduser";
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            console.log(xhr.responseText)
                            if (this.responseText == "пользователь добавлен") {
                                alert('Пользователь был создан')
                                goToAdmin();
                                history.pushState({}, '', '#adm')
                                document.title = 'Администрирование'
                            }
                            if (this.responseText == "Пользователь с таких именем уже существует")
                                alert("Пользователь с таким именем уже существует")
                        }
                    };
                    var data = JSON.stringify({
                        "name": enter_enter.value,
                        "pwd": enter_pass.value,
                        "accesslist": accesslist
                    });
                    xhr.send(data);
                }
            }
        }


        function goToAdminEdit() {
            sessionStorage.setItem('page', 'adm/edit')
            clearInterval(timerTablo)
            let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
            document.body.innerHTML = inner;
            name_logout.textContent = nickName
            let cur_menu = document.getElementById('admin');
            cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
            let name_menu = '<div class="name_menu">Редактирование пользователя</div>'
            document.body.innerHTML += name_menu;
            let horiz_line = '<div class="horiz_line"></div>'
            document.body.innerHTML += horiz_line;
            let enter_name = '<div class="enter_username"><div class="enter_main">Имя пользователя</div><input autocomplete="off" type="text" id="enter_enter" class="enter_enter"></div>'
            document.body.innerHTML += enter_name;
            let enter_pass1 = '<div class="enter_password"><div class="enter_main">Пароль</div><input autocomplete="off" type="text" id="enter_pass" class="enter_enter"></div>'
            document.body.innerHTML += enter_pass1;
            enter_pass1 = '<div class="enter_password"><div class="enter_main">Повторите пароль</div><input autocomplete="off" type="text" id="enter_pass2" class="enter_enter"></div>'
            document.body.innerHTML += enter_pass1;
            let create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Управление доступом</div></div>'
            document.body.innerHTML += create_settings_user;
            create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Просмотр списка происшествий</div></div>'
            document.body.innerHTML += create_settings_user;
            create_settings_user = '<div class="create_settings_user"><div class="small_quadro"></div><div class="settings_text">Редактирование происшествий</div></div>'
            document.body.innerHTML += create_settings_user;
            let safe_button = '<a class="safe_button">Сохранить</a>'
            document.body.innerHTML += safe_button;
            let cancel_button = '<a class="cancel_button">Отмена</a>'
            document.body.innerHTML += cancel_button;
            var settings = document.body.getElementsByClassName('small_quadro')
            let func_flag = function () {
                if (this.flag == 0) {
                    this.style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    this.flag = 1
                } else {
                    this.style.background = 'white'
                    this.flag = 0
                }
            }
            for (let i = 0; i < 2; i++) {
                settings[i].flag = 0
                settings[i].addEventListener('click', func_flag)
            }
            let func_flag2 = function () {
                if (this.flag == 0) {
                    settings[1].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    settings[1].style.opacity = '50%'
                    settings[2].style.background = 'url(images/flag.png) -1px -1px/18px 18px no-repeat'
                    settings[1].flag = 1
                    this.flag = 1
                    settings[1].removeEventListener('click', func_flag)
                } else {
                    settings[1].style.opacity = '100%'
                    settings[2].style.background = 'white'
                    this.flag = 0
                    settings[1].addEventListener('click', func_flag)
                }
            }
            settings[2].flag = 0
            settings[2].addEventListener('click', func_flag2)

            /*--------------------------------------------------------------------------*/

            logout.addEventListener('click', function () {
                window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                sessionStorage.removeItem('page')
            })
            let but_create_user = document.getElementsByClassName('safe_button')[0]
            let but_cancel_create_user = document.getElementsByClassName('cancel_button')[0]
            let but_monitoring = document.getElementById('monitor')
            but_monitoring.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }
            admin.onclick = () => {
                goToAdmin()
                history.pushState({}, '', '#adm')
                document.title = 'Администрирование'
            }


            /*   НАЖАТИЕ КНОПКИ ОТМЕНА   */


            but_cancel_create_user.onclick = function () {
                console.log('Пользователь не редактирован')
                goToAdmin()
                history.pushState({}, '', '#adm')
                document.title = 'Администрирование'
            }


            /*   НАЖАТИЕ КНОПКИ СОХРАНИТЬ   */


            but_create_user.onclick = function () {

                let inm = document.getElementsByClassName('enter_username')[0]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }
                inm = document.getElementsByClassName('enter_password')[0]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }
                inm = document.getElementsByClassName('enter_password')[1]
                if (inm.children[2]) {
                    inm.removeChild(inm.children[2])
                }

                let settings = document.getElementsByClassName('small_quadro')
                if (!enter_enter.value)
                    console.log('пользователь', enter_enter)
                if (!enter_pass.value)
                    console.log('пароль', enter_pass.value)
                if (enter_pass.value != enter_pass2.value)
                    console.log('пароли')
                if (!enter_enter.value || !enter_pass.value || enter_pass.value != enter_pass2.value || enter_enter.value.length > 30 || enter_pass.value.length > 30 || enter_pass2.value.length > 30) {
                    console.log('Данные не введены полностью')
                    if (enter_pass.value != enter_pass2.value) {
                        let inm = document.getElementsByClassName('enter_password')[0]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Пароли не совпали'

                    }
                    if (!enter_pass.value || !enter_pass2.value) {
                        let inm = document.getElementsByClassName('enter_password')[0]
                        if (!inm.children[2]) {
                            let er = document.createElement('div')
                            er.classList.add('mismatch')
                            inm.appendChild(er)
                            er.textContent = 'Пароль не введён'
                        }
                    }
                    if (enter_enter.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_username')[0]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Длина должна быть не больше 30 символов'

                    }
                    if (enter_pass.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_password')[1]

                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        inm.appendChild(er)
                        er.textContent = 'Длина должна быть не больше 30 символов'

                    }
                    if (enter_pass2.value.length > 30) {
                        let inm = document.getElementsByClassName('enter_password')[1]
                        if (!inm.children[2]) {
                            let er = document.createElement('div')
                            er.classList.add('mismatch')
                            inm.appendChild(er)
                            er.textContent = 'Длина должна быть не больше 30 символов'
                        }
                    }
                } else {
                    console.log('Редактирован пользователь')
                    console.log('Имя: ', enter_enter.value)
                    console.log('Пароль: ', enter_pass.value)
                    let accesslist = ""
                    for (let i = 0; i < settings.length; i++) {
                        if (settings[i].style.backgroundImage == 'url("images/flag.png")') {
                            accesslist += 1
                        } else {
                            accesslist += 0
                        }
                    }
                    console.log('Включены настройки: ', accesslist)
                    let xhr = new XMLHttpRequest();
                    let url = location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + "updateuser";
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            if (this.responseText == 'User updated') {
                                alert('Пользователь был редактирован')
                                goToAdmin();
                                history.pushState({}, '', '#adm')
                                document.title = 'Администрирование'
                            }
                            if (this.responseText == 'Нельзя обновить текущего пользователя') {
                                alert(this.responseText)
                                goToAdmin();
                                history.pushState({}, '', '#adm')
                                document.title = 'Администрирование'
                            }
                        }
                    };
                    var data = JSON.stringify({
                        "newName": enter_enter.value,
                        "newAccessList": accesslist,
                        "newPwd": enter_pass.value,
                        "id": document.getElementsByClassName('spann')[0].textContent
                    });
                    xhr.send(data);
                }
            }
        }


        function fillingTablo() {
            return new Promise((resolve, reject) => {
                xhr = new XMLHttpRequest()
                xhr.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'monitoring');
                xhr.addEventListener('load', () => {
                    resolve(xhr.response)
                })
                xhr.addEventListener('error', () => {
                    reject()
                })
                xhr.send()
            }).then(text13 => {
                return new Promise((resolve) => {
                    let main = JSON.parse(text13);
                    let first_line = document.getElementsByClassName('tablo_wide')[0]
                    let second_line = document.getElementsByClassName('tablo_wide')[1]
                    let third_line = document.getElementsByClassName('tablo_wide')[2]
                    for (let i = 0; i < main.length; i++) {
                        if (main[i].number == 1) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[13].style.background = 'green'
                                second_line.getElementsByTagName('td')[13].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[13].style.background = 'yellow'
                                second_line.getElementsByTagName('td')[13].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[13].style.background = 'red'
                                second_line.getElementsByTagName('td')[13].style.background = 'red'
                            }
                        }
                        if (main[i].number == 2) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[11].style.background = 'green'
                                first_line.getElementsByTagName('td')[12].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[11].style.background = 'yellow'
                                first_line.getElementsByTagName('td')[12].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[11].style.background = 'red'
                                first_line.getElementsByTagName('td')[12].style.background = 'red'
                            }
                        }
                        if (main[i].number == 3) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[11].style.background = 'green'
                                second_line.getElementsByTagName('td')[12].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[11].style.background = 'yellow'
                                second_line.getElementsByTagName('td')[12].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[11].style.background = 'red'
                                second_line.getElementsByTagName('td')[12].style.background = 'red'
                            }
                        }
                        if (main[i].number == 4) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[10].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[10].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[10].style.background = 'red'
                            }
                        }
                        if (main[i].number == 5) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[10].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[10].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[10].style.background = 'red'
                            }
                        }
                        if (main[i].number == 6) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[9].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[9].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[9].style.background = 'red'
                            }
                        }
                        if (main[i].number == 7) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[9].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[9].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[9].style.background = 'red'
                            }
                        }
                        if (main[i].number == 8) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[8].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[8].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[8].style.background = 'red'
                            }
                        }
                        if (main[i].number == 9) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[8].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[8].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[8].style.background = 'red'
                            }
                        }
                        if (main[i].number == 10) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[7].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[7].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[7].style.background = 'red'
                            }
                        }
                        if (main[i].number == 11) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[7].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[7].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[7].style.background = 'red'
                            }
                        }
                        if (main[i].number == 12) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[6].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[6].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[6].style.background = 'red'
                            }
                        }
                        if (main[i].number == 13) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[6].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[6].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[6].style.background = 'red'
                            }
                        }
                        if (main[i].number == 14) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[5].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[5].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[5].style.background = 'red'
                            }
                        }
                        if (main[i].number == 15) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[5].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[5].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[5].style.background = 'red'
                            }
                        }
                        if (main[i].number == 16) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[4].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[4].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[4].style.background = 'red'
                            }
                        }
                        if (main[i].number == 17) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[4].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[4].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[4].style.background = 'red'
                            }
                        }
                        if (main[i].number == 18) {
                            if (main[i].btype == 1) {
                                first_line.getElementsByTagName('td')[3].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                first_line.getElementsByTagName('td')[3].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                first_line.getElementsByTagName('td')[3].style.background = 'red'
                            }
                        }
                        if (main[i].number == 19) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[3].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[3].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[3].style.background = 'red'
                            }
                        }
                        if (main[i].number == 20) {
                            if (main[i].btype == 1) {
                                second_line.getElementsByTagName('td')[2].style.background = 'green'
                                first_line.getElementsByTagName('td')[2].style.background = 'green'
                                second_line.getElementsByTagName('td')[1].style.background = 'green'
                                first_line.getElementsByTagName('td')[1].style.background = 'green'
                                second_line.getElementsByTagName('td')[0].style.background = 'green'
                                first_line.getElementsByTagName('td')[0].style.background = 'green'
                            }
                            if (main[i].btype == 2) {
                                second_line.getElementsByTagName('td')[2].style.background = 'yellow'
                                first_line.getElementsByTagName('td')[2].style.background = 'yellow'
                                second_line.getElementsByTagName('td')[1].style.background = 'yellow'
                                first_line.getElementsByTagName('td')[1].style.background = 'yellow'
                                second_line.getElementsByTagName('td')[0].style.background = 'yellow'
                                first_line.getElementsByTagName('td')[0].style.background = 'yellow'
                            }
                            if (main[i].btype == 3) {
                                second_line.getElementsByTagName('td')[2].style.background = 'red'
                                first_line.getElementsByTagName('td')[2].style.background = 'red'
                                second_line.getElementsByTagName('td')[1].style.background = 'red'
                                first_line.getElementsByTagName('td')[1].style.background = 'red'
                                second_line.getElementsByTagName('td')[0].style.background = 'red'
                                first_line.getElementsByTagName('td')[0].style.background = 'red'
                            }
                        }
                    }
                    for (let i = 0; i < 14; i++) {
                        if (first_line.getElementsByTagName('td')[i].style.background == 'red' || second_line.getElementsByTagName('td')[i].style.background == 'red')
                            third_line.getElementsByTagName('td')[i].style.background = 'red'
                        else {
                            third_line.getElementsByTagName('td')[i].style.background = 'white'
                        }
                    }
                    console.log('Заполнили табло')
                    resolve()
                })
            })
        }


        function fillingHelpingListalka(e) {
            let type_cod = null
            if (filter_type.textContent == 'Некомплектность')
                type_cod = 1
            if (filter_type.textContent == 'Авария')
                type_cod = 2
            if (filter_type.textContent == 'Травма')
                type_cod = 3
            if (filter_type.textContent == 'Другое')
                type_cod = 4
            let post_cod = null
            let time1 = null
            let time1end = null
            let time2 = null
            let time2end = null
            if (filter_post.value)
                post_cod = filter_post.value
            if (filter_time.textContent != 'Время фиксации') {
                time1 = filter_time.startTime
                time1end = filter_time.endTime
            }
            if (filter_timeDone.textContent != 'Время устранения') {
                time2 = filter_timeDone.startTime
                time2end = filter_timeDone.endTime
            }
            new Promise((resolve, reject) => {

                xhr = new XMLHttpRequest()
                if (!(filter_post.value == "" && filter_type.innerText.split('\n')[0] == 'Тип происшествия' && filter_time.innerText.split('\n')[0] == 'Время фиксации' && filter_timeDone.innerText.split('\n')[0] == 'Время устранения')) {
                    xhr.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'accidentfiltered');
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.addEventListener('load', () => {
                        resolve(xhr.response)
                    })
                    xhr.addEventListener('error', () => {
                        reject()
                    })
                    var data = JSON.stringify({
                        "aTypeId": type_cod,
                        "post": post_cod,
                        "accidentdatefirst": time1,
                        "accidentdatesecond": time1end,
                        "accidentdatefirstend": time2,
                        "accidentdatesecondend": time2end,
                        "startprom": 10 * (0 + e.textContent) - 9,
                        "endprom": 10 * (0 + e.textContent)
                    });
                } else {
                    xhr.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'testaccidents');
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.addEventListener('load', () => {
                        resolve(xhr.response)
                    })
                    xhr.addEventListener('error', () => {
                        reject()
                    })
                    var data = JSON.stringify({
                        "startprom": 10 * (0 + e.textContent) - 9,
                        "endprom": 10 * (0 + e.textContent)
                    });
                }
                xhr.send(data)
            }).then(text => {
                let main
                let count_filtered
                if (!(filter_post.value == "" && filter_type.innerText.split('\n')[0] == 'Тип происшествия' && filter_time.innerText.split('\n')[0] == 'Время фиксации' && filter_timeDone.innerText.split('\n')[0] == 'Время устранения')) {
                    count_filtered = JSON.parse(text)[0]
                    main = JSON.parse(text)[1]
                } else {
                    count_filtered = countIncident
                    main = JSON.parse(text)
                }
                console.log(main)
                if (e.classList.contains('listalka_point')) {
                    let table = document.getElementsByTagName('table')[1]
                    let s = table.children.length
                    for (let i = s - 1; i > 0; i--) {
                        console.log(table.children[i])
                        table.removeChild(table.children[i])
                    }
                    table.innerHTML += ''
                    for (let i = 0; i < 10 && i < count_filtered - 10 * (0 + e.textContent) + 10; i++) {
                        let row = '<tr class="row"><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td></tr>'
                        table.innerHTML += row
                        console.log(row)
                        let rows = document.body.getElementsByClassName('row')
                        row = rows[rows.length - 1]
                        let cells = row.getElementsByTagName('td')
                        cells[0].innerText = main[i].post
                        if (main[i].atypeId)
                            cells[1].innerText = main[i].atypeId.name
                        cells[2].innerText = main[i].description
                        if (main[i].startTime != null) {
                            let time = new Date(main[i].startTime)
                            let secunds = Date.parse(time) + 10800000
                            time = new Date(secunds)
                            let month = time.getMonth() + 1
                            let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                            cells[3].innerText = time_string
                        }
                        if (main[i].endTime != null) {
                            let time = new Date(main[i].endTime)
                            let secunds = Date.parse(time) + 10800000
                            time = new Date(secunds)
                            let month = time.getMonth() + 1
                            let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                            cells[4].innerText = time_string
                        }
                        let imgs = document.createElement('div')
                        if (access[2] == 1) {
                            let image1 = document.createElement('img')
                            image1.src = 'images/green.png'
                            image1.classList.add('image_unit', 'green_edit')
                            imgs.appendChild(image1)
                        }
                        let image2 = document.createElement('img')
                        image2.src = 'images/history.png'
                        image2.classList.add('image_unit', 'history_list_img')
                        let span = document.createElement('span')
                        span.textContent = main[i].id
                        span.style.display = "none"
                        span.classList.add('spann')
                        imgs.appendChild(image2)
                        cells[5].appendChild(span)
                        cells[5].appendChild(imgs)
                        imgs.classList.add('imgs')
                    }
                    let points = document.getElementsByClassName('listalka_point')
                    for (let i = 0; i < points.length; i++)
                        if (points[i].classList.contains('listalka_point_color'))
                            points[i].classList.remove('listalka_point_color')
                    e.classList.add('listalka_point_color')
                }
            })
        }


        function goToMonitoring() {
            sessionStorage.setItem('page', 'mon')
            numberOfListalka = 1
            new Promise((resolve, reject) => {
                xhr_name = new XMLHttpRequest()
                xhr_name.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getusername');
                xhr_name.addEventListener('load', () => {
                    resolve(xhr_name.response)
                })
                xhr_name.addEventListener('error', () => {
                    reject()
                })
                xhr_name.send()
            }).then(text => {
                return new Promise((resolve) => {
                    nickName = text
                    resolve()
                })
            }).then(() => {
                let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
                document.body.innerHTML = inner;
                name_logout.textContent = nickName
                let cur_menu = document.getElementById('monitor');
                cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
                /*--------------------------      Табло       --------------------------------------*/
                let divchik = document.createElement('div')
                divchik.classList.add('divchik')
                document.body.appendChild(divchik)
                let tablo = document.createElement('table')
                divchik.appendChild(tablo)
                let table_row_slim = document.createElement('tr')
                tablo.appendChild(table_row_slim)
                let table_row_wide
                let table_cell
                for (let i = 0; i < 14; i++) {
                    table_cell = document.createElement('td')
                    table_cell.textContent = 13 - i
                    table_row_slim.appendChild(table_cell)
                }
                table_row_slim.classList.add('tablo_slim')
                table_row_wide = document.createElement('tr')
                tablo.appendChild(table_row_wide)
                for (let i = 0; i < 14; i++) {
                    table_cell = document.createElement('td')
                    table_row_wide.appendChild(table_cell)
                }
                table_row_wide.classList.add('tablo_wide')
                table_row_wide = document.createElement('tr')
                tablo.appendChild(table_row_wide)
                for (let i = 0; i < 14; i++) {
                    table_cell = document.createElement('td')
                    table_row_wide.appendChild(table_cell)
                }
                table_row_wide.classList.add('tablo_wide')
                table_row_slim = document.createElement('tr')
                tablo.appendChild(table_row_slim)
                for (let i = 0; i < 14; i++) {
                    table_cell = document.createElement('td')
                    table_cell.textContent = 27 - i
                    table_row_slim.appendChild(table_cell)
                }
                table_row_slim.classList.add('tablo_slim')
                table_row_wide = document.createElement('tr')
                tablo.appendChild(table_row_wide)
                for (let i = 0; i < 14; i++) {
                    table_cell = document.createElement('td')
                    table_row_wide.appendChild(table_cell)
                }
                table_row_wide.classList.add('tablo_wide')

                fillingTablo().then(() => {

                    if (access[1] == 1) {
                        /*----------------------------------------------------------------------------------*/
                        let name_menu = '<div class="name_menu">Список происшествий</div>'
                        document.body.innerHTML += name_menu;
                        let horiz_line = '<div class="horiz_line"></div>'
                        document.body.innerHTML += horiz_line;
                        let filtr_main = '<div class="user_name" style="width: auto">Фильтры</div>'
                        document.body.innerHTML += filtr_main;
                        let filter_menu = '<div class="filter_menu"><div class="filter_circle"></div><input type="number" autocomplete="off" class="filter_unit" id="filter_post" placeholder="Номер поста"><div class="filter_circle"></div><div class="filter_unit" id="filter_type">Тип происшествия</div><div class="filter_circle"></div><div class="filter_unit" id="filter_time">Время фиксации</div><div class="filter_circle"></div><div class="filter_unit" id="filter_timeDone">Время устранения</div><div class="filter_circle"></div></input>'
                        document.body.innerHTML += filter_menu;
                        let twoDiv = document.createElement('div')
                        twoDiv.classList.add('apply_throw')
                        let but_apply = document.createElement('div')
                        but_apply.classList.add('but_filter_apply')
                        but_apply.innerText = 'Применить'
                        twoDiv.appendChild(but_apply)
                        but_apply = document.createElement('div')
                        but_apply.classList.add('but_filter_throw')
                        but_apply.innerText = 'Сбросить'
                        twoDiv.appendChild(but_apply)
                        document.body.appendChild(twoDiv)
                        document.body.innerHTML += horiz_line;
                        let reqCount
                        new Promise((resolve, reject) => {
                            reqCount = new XMLHttpRequest()
                            reqCount.open('GET', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'count');
                            reqCount.setRequestHeader("Content-Type", "application/json");
                            reqCount.addEventListener('load', () => {
                                resolve(reqCount.response)
                            })
                            reqCount.addEventListener('error', () => {
                                reject()
                            })
                            reqCount.send()
                        }).then(text => {
                            countIncident = text
                            console.log(countIncident)
                        }).then(() => {
                            new Promise((resolve, reject) => {
                                let req8
                                req8 = new XMLHttpRequest()
                                req8.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'testaccidents');
                                req8.setRequestHeader("Content-Type", "application/json");
                                req8.addEventListener('load', () => {
                                    resolve(req8.response)
                                })
                                req8.addEventListener('error', () => {
                                    reject()
                                })
                                var data = JSON.stringify({"startprom": 1, "endprom": 10});
                                req8.send(data)
                            }).then(text => {
                                let main = JSON.parse(text);
                                if (main.length != 0) {
                                    console.log(main)
                                    let divchik = document.createElement('div')
                                    divchik.classList.add('divchik')
                                    document.body.appendChild(divchik)
                                    let cap = '<table><tr class="cap"><th class="cap_unit">Номер поста</th><th class="cap_unit">Тип происшествия</th><th class="cap_unit">Описание</th><th class="cap_unit">Время фиксации происшествия</th><th class="cap_unit">Время устранения происшествия</th><th class="cap_unit">Изменить/<br>Посмотреть изменения</th></tr></table>'
                                    divchik.innerHTML += cap
                                    let table = document.body.getElementsByTagName('table')[1]
                                    for (let i = 0; i < 10 && i < main.length; i++) {
                                        let row = '<tr class="row"><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td></tr>'
                                        table.innerHTML += row
                                        let rows = document.body.getElementsByTagName('tr')
                                        row = rows[rows.length - 1]
                                        let cells = row.getElementsByTagName('td')
                                        cells[0].innerText = main[i].post
                                        if (main[i].atypeId)
                                            cells[1].innerText = main[i].atypeId.name
                                        cells[2].innerText = main[i].description
                                        if (main[i].startTime != null) {
                                            let time = new Date(main[i].startTime)
                                            let secunds = Date.parse(time) + 10800000
                                            time = new Date(secunds)
                                            let month = time.getMonth() + 1
                                            let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                            cells[3].innerText = time_string
                                        }
                                        if (main[i].endTime != null) {
                                            let time = new Date(main[i].endTime)
                                            let secunds = Date.parse(time) + 10800000
                                            time = new Date(secunds)
                                            let month = time.getMonth() + 1
                                            let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                            cells[4].innerText = time_string
                                        }
                                        let image2 = document.createElement('img')
                                        let span = document.createElement('span')
                                        span.textContent = main[i].id
                                        span.style.display = "none"
                                        span.classList.add('spann')
                                        let imgs = document.createElement('div')
                                        image2.src = 'images/history.png'
                                        image2.classList.add('image_unit', 'history_list_img')
                                        if (access[2] == 1) {
                                            let image1 = document.createElement('img')
                                            image1.src = 'images/green.png'
                                            image1.classList.add('image_unit', 'green_edit')
                                            imgs.appendChild(image1)
                                        }
                                        imgs.appendChild(image2)
                                        cells[5].appendChild(span)
                                        cells[5].appendChild(imgs)
                                        imgs.classList.add('imgs')
                                    }
                                    let listalka = document.createElement('div')
                                    listalka.classList.add('listalka')
                                    document.body.appendChild(listalka)
                                    for (let i = 0; i < Math.ceil(countIncident / 10); i++) {
                                        let punkt = document.createElement('div')
                                        punkt.classList.add('listalka_point')
                                        punkt.textContent = i + 1
                                        listalka.appendChild(punkt)
                                    }
                                    listalka = document.querySelector('.listalka_point')
                                    if (listalka)
                                        listalka.classList.add('listalka_point_color')
                                } else {
                                    let empty = document.createElement('div')
                                    empty.innerText = 'Список пуст'
                                    document.body.appendChild(empty)
                                    empty.classList.add('empty')
                                }

                                logout.addEventListener('click', function () {
                                    window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                                    sessionStorage.removeItem('page')
                                })

                                admin.onclick = () => {
                                    if (access[0] == 1) {
                                        goToAdmin()
                                        history.pushState({}, '', '#adm')
                                        document.title = 'Администрирование'
                                    } else {
                                        goToProhibit()
                                        history.pushState({}, '', '#access')
                                        document.title = 'Нет прав'
                                    }
                                }
                                let but_deleteOrEdit_user = document.getElementsByTagName('table')[1]
                                but_deleteOrEdit_user.addEventListener('click', function (event) {
                                    if (event.target.classList.contains('green_edit')) {
                                        console.log('редактирование')
                                        let that = event.target
                                        let nodes = document.body.getElementsByClassName('row')
                                        let descriptionI
                                        let typeI
                                        let timeI
                                        let timeDoneI
                                        let postI
                                        let idI
                                        for (let i = 0; i < nodes.length; i++) {
                                            if (that.parentNode.parentNode.parentNode == nodes[i]) {
                                                typeI = nodes[i].children[1].textContent
                                                objForMonEdit[0] = (typeI)
                                                sessionStorage.setItem('typeI', typeI)
                                                descriptionI = nodes[i].children[2].textContent
                                                objForMonEdit[1] = (descriptionI)
                                                sessionStorage.setItem('descriptionI', descriptionI)
                                                timeI = nodes[i].children[3].textContent
                                                objForMonEdit[2] = (timeI)
                                                sessionStorage.setItem('timeI', timeI)
                                                timeDoneI = nodes[i].children[4].textContent
                                                objForMonEdit[3] = (timeDoneI)
                                                sessionStorage.setItem('timeDoneI', timeDoneI)
                                                postI = nodes[i].children[0].textContent
                                                objForMonEdit[4] = (postI)
                                                sessionStorage.setItem('postI', postI)

                                                idI = nodes[i].children[5].getElementsByClassName('spann')[0].textContent
                                                objForMonEdit[5] = (idI)
                                                sessionStorage.setItem('idI', idI)
                                            }
                                        }
                                        goToMonitoringEdit()
                                        history.pushState({}, '', '#mon/edit')
                                        document.title = 'Редактирование происшествия'
                                        let inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                                        let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                                        let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                                        let inp4 = document.body.getElementsByClassName('inp3')[0]
                                        let span = document.createElement('span')
                                        span.classList.add('spann')
                                        span.textContent = idI
                                        console.log(idI, typeI, postI)
                                        span.style.display = "none"
                                        document.body.appendChild(span)
                                        inp1.textContent = postI
                                        inp2.textContent = timeI
                                        inp3.textContent = timeDoneI
                                        inp4.value = descriptionI
                                        let type = document.body.getElementsByClassName('inp2')[0].children
                                        let flag = 0
                                        for (let i = 0; i < 4; i++) {
                                            if (typeI == type[i].textContent) {
                                                type[i].style.background = 'black'
                                                type[i].style.color = 'white'
                                                flag = 1
                                            }
                                        }
                                    }
                                    if (event.target.classList.contains('history_list_img')) {
                                        goToMonitoringHistory(event.target)
                                        history.pushState({}, '', '#mon/history')
                                        document.title = 'История происшествия'
                                    }
                                })

                                filter_time.onclick = (e) => {
                                    if (e.target.tagName == 'DIV' && !document.getElementsByClassName('dropmenu_type')[0]) {
                                        setTimeout(() => {
                                            let new_menu = document.createElement('div')
                                            let row = document.createElement('div')
                                            new_menu.classList.add('dropmenu_type')
                                            new_menu.classList.add('dropmenu_type11')
                                            filter_time.appendChild(new_menu)
                                            let input = document.createElement('input')
                                            input.type = "datetime-local"
                                            row.appendChild(input)
                                            row.innerHTML += '<div style="font-size: 40px">-</div>'
                                            input = document.createElement('input')
                                            input.type = "datetime-local"
                                            row.appendChild(input)
                                            new_menu.appendChild(row)
                                            row = document.createElement('div')
                                            input = document.createElement('div')
                                            input.classList.add('dropmenu_button')
                                            input.innerText += 'OK'
                                            row.appendChild(input)
                                            new_menu.appendChild(row)
                                        }, 100)
                                    }
                                    if (e.target.classList.contains('dropmenu_button') && document.getElementsByClassName('dropmenu_type')[0]) {
                                        if (filter_time.querySelectorAll('input')[0].value != "") {
                                            let timeTime = new Date(filter_time.querySelectorAll('input')[0].value)
                                            let secunds = Date.parse(timeTime)
                                            filter_time.startTime = new Date(secunds).toISOString().slice(0, 19)
                                        }
                                        if (filter_time.querySelectorAll('input')[1].value != "") {
                                            timeTime = new Date(filter_time.querySelectorAll('input')[1].value)
                                            secunds = Date.parse(timeTime)
                                            filter_time.endTime = new Date(secunds).toISOString().slice(0, 19)
                                        }
                                        let time_string1
                                        let time_string2
                                        if (filter_time.querySelectorAll('input')[0].value != "") {
                                            let time = new Date(filter_time.querySelectorAll('input')[0].value)
                                            console.log(time)
                                            let month = time.getMonth() + 1
                                            time_string1 = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds()
                                        }
                                        if (filter_time.querySelectorAll('input')[1].value != "") {
                                            let time = new Date(filter_time.querySelectorAll('input')[1].value)
                                            console.log(time)
                                            let month = time.getMonth() + 1
                                            time_string2 = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds()
                                        }
                                        if (!filter_time.querySelectorAll('input')[0].value && !filter_time.querySelectorAll('input')[1].value)
                                            filter_time.textContent = 'Время фиксации'
                                        else
                                            filter_time.textContent = time_string1 + ' - ' + time_string2
                                        if (filter_time.textContent != 'Время фиксации') {
                                            let krest = document.createElement('img')
                                            krest.src = 'images/pngwing.png'
                                            krest.classList.add('filter_krest')
                                            filter_time.appendChild(krest)
                                        }
                                    }
                                }
                                filter_timeDone.onclick = (e) => {
                                    if (e.target.tagName == 'DIV' && !document.getElementsByClassName('dropmenu_type')[0]) {
                                        setTimeout(() => {
                                            let new_menu = document.createElement('div')
                                            let row = document.createElement('div')
                                            new_menu.classList.add('dropmenu_type')
                                            new_menu.classList.add('dropmenu_type12')
                                            filter_timeDone.appendChild(new_menu)
                                            let input = document.createElement('input')
                                            input.type = 'datetime-local'
                                            row.appendChild(input)
                                            row.innerHTML += '<div style="font-size: 40px">-</div>'
                                            input = document.createElement('input')
                                            input.type = 'datetime-local'
                                            row.appendChild(input)
                                            new_menu.appendChild(row)
                                            row = document.createElement('div')
                                            input = document.createElement('div')
                                            input.classList.add('dropmenu_button')
                                            input.innerText += 'OK'
                                            row.appendChild(input)
                                            new_menu.appendChild(row)
                                        }, 100)
                                    }
                                    if (e.target.classList.contains('dropmenu_button') && document.getElementsByClassName('dropmenu_type')[0]) {
                                        if (filter_timeDone.querySelectorAll('input')[0].value != "") {
                                            let timeTime = new Date(filter_timeDone.querySelectorAll('input')[0].value)
                                            let secunds = Date.parse(timeTime)/* - 10800000*/
                                            filter_timeDone.startTime = new Date(secunds).toISOString().slice(0, 19)
                                        }
                                        if (filter_timeDone.querySelectorAll('input')[1].value != "") {
                                            timeTime = new Date(filter_timeDone.querySelectorAll('input')[1].value)
                                            secunds = Date.parse(timeTime)/* - 10800000*/
                                            filter_timeDone.endTime = new Date(secunds).toISOString().slice(0, 19)
                                        }
                                        let time_string1
                                        let time_string2
                                        if (filter_timeDone.querySelectorAll('input')[0].value != "") {
                                            let time = new Date(filter_timeDone.querySelectorAll('input')[0].value)
                                            console.log(time)
                                            let month = time.getMonth() + 1
                                            time_string1 = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds()
                                        }
                                        if (filter_timeDone.querySelectorAll('input')[1].value != "") {
                                            let time = new Date(filter_timeDone.querySelectorAll('input')[1].value)
                                            console.log(time)
                                            let month = time.getMonth() + 1
                                            time_string2 = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds()
                                        }
                                        if (!filter_timeDone.querySelectorAll('input')[0].value && !filter_timeDone.querySelectorAll('input')[1].value)
                                            filter_timeDone.textContent = 'Время фиксации'
                                        else
                                            filter_timeDone.textContent = time_string1 + ' - ' + time_string2
                                        if (filter_timeDone.textContent != 'Время фиксации') {
                                            let krest = document.createElement('img')
                                            krest.src = 'images/pngwing.png'
                                            krest.classList.add('filter_krest')
                                            filter_timeDone.appendChild(krest)
                                        }
                                    }
                                }
                                filter_type.onclick = (e) => {
                                    if (e.target.tagName == 'DIV' && !document.getElementsByClassName('dropmenu_type1')[0]) {
                                        setTimeout(() => {
                                            let new_menu = document.createElement('div')
                                            new_menu.classList.add('dropmenu_type1')
                                            filter_type.appendChild(new_menu)
                                            let row = document.createElement('div')
                                            row.classList.add('dropmenutype_row')
                                            row.innerText = 'Некомплектность'
                                            new_menu.appendChild(row)
                                            row = document.createElement('div')
                                            row.classList.add('dropmenutype_row')
                                            row.innerText = 'Авария'
                                            new_menu.appendChild(row)
                                            row = document.createElement('div')
                                            row.classList.add('dropmenutype_row')
                                            row.innerText = 'Травма'
                                            new_menu.appendChild(row)
                                            row = document.createElement('div')
                                            row.classList.add('dropmenutype_row')
                                            row.innerText = 'Другое'
                                            new_menu.appendChild(row)
                                        }, 100)
                                    }

                                    if (e.target.classList.contains('dropmenutype_row') && document.getElementsByClassName('dropmenu_type1')[0]) {
                                        filter_type.textContent = e.target.textContent
                                        if (filter_type.textContent != 'Тип происшествия') {
                                            let krest = document.createElement('img')
                                            krest.src = 'images/pngwing.png'
                                            krest.classList.add('filter_krest')
                                            filter_type.appendChild(krest)
                                        }
                                    }
                                }


                                window.addEventListener('click', function (e) {
                                    if (document.getElementsByClassName('dropmenu_type1')[0] && e.target != document.getElementsByClassName('dropmenu_type1')[0]) {
                                        filter_type.removeChild(document.getElementsByClassName('dropmenu_type1')[0])
                                    }
                                    if (document.getElementsByClassName('dropmenu_type11')[0]) {
                                        let elem = e.target

                                        while (!elem.classList.contains('container') && !elem.classList.contains('dropmenu_type11')) {
                                            elem = elem.parentNode
                                        }
                                        if (elem.classList.contains('container')) {
                                            filter_time.removeChild(document.getElementsByClassName('dropmenu_type11')[0])
                                        }
                                    }
                                    if (document.getElementsByClassName('dropmenu_type12')[0]) {
                                        let elem = e.target
                                        while (!elem.classList.contains('container') && !elem.classList.contains('dropmenu_type12')) {
                                            elem = elem.parentNode
                                        }
                                        if (elem.classList.contains('container')) {
                                            filter_timeDone.removeChild(document.getElementsByClassName('dropmenu_type12')[0])
                                        }
                                    }
                                })

                                document.body.onclick = (e) => {
                                    if (e.target.classList.contains('filter_krest')) {
                                        if (e.target.parentNode == filter_type) {
                                            e.target.parentNode.textContent = 'Тип происшествия'
                                        }
                                        if (e.target.parentNode == filter_time) {
                                            e.target.parentNode.textContent = 'Время фиксации'
                                            filter_time.startTime = null
                                            filter_time.endTime = null
                                        }
                                        if (e.target.parentNode == filter_timeDone) {
                                            e.target.parentNode.textContent = 'Время устранения'
                                            filter_timeDone.startTime = null
                                            filter_timeDone.endTime = null
                                        }
                                    }
                                }
                                let listalka = document.getElementsByClassName('listalka')[0]
                                if (listalka) {
                                    listalka.onclick = (e) => {
                                        numberOfListalka = e.target.textContent
                                        new Promise((resolve, reject) => {
                                            xhr = new XMLHttpRequest()
                                            xhr.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'testaccidents');
                                            xhr.setRequestHeader("Content-Type", "application/json");
                                            xhr.addEventListener('load', () => {
                                                resolve(xhr.response)
                                            })
                                            xhr.addEventListener('error', () => {
                                                reject()
                                            })
                                            var data = JSON.stringify({
                                                "startprom": 10 * (0 + e.target.textContent) - 9,
                                                "endprom": 10 * (0 + e.target.textContent)
                                            });
                                            xhr.send(data)
                                        }).then(text => {
                                            let main = JSON.parse(text)
                                            if (e.target.classList.contains('listalka_point')) {
                                                console.log('вошли в листалку')
                                                let table = document.getElementsByTagName('table')[1]
                                                for (let i = table.children.length - 1; i > 0; i--) {
                                                    table.removeChild(table.children[i])
                                                }
                                                for (let i = 0; i < 10 && i < countIncident - 10 * (0 + e.target.textContent) + 10; i++) {
                                                    let row = '<tr class="row"><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td></tr>'
                                                    table.innerHTML += row
                                                    let rows = document.body.getElementsByTagName('tr')
                                                    row = rows[rows.length - 1]
                                                    let cells = row.getElementsByTagName('td')
                                                    cells[0].innerText = main[i].post
                                                    if (main[i].atypeId)
                                                        cells[1].innerText = main[i].atypeId.name
                                                    cells[2].innerText = main[i].description
                                                    if (main[i].startTime != null) {
                                                        let time = new Date(main[i].startTime)
                                                        let secunds = Date.parse(time) + 10800000
                                                        time = new Date(secunds)
                                                        let month = time.getMonth() + 1
                                                        let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                                        cells[3].innerText = time_string
                                                    }
                                                    if (main[i].endTime != null) {
                                                        let time = new Date(main[i].endTime)
                                                        let secunds = Date.parse(time) + 10800000
                                                        time = new Date(secunds)
                                                        let month = time.getMonth() + 1
                                                        let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                                        cells[4].innerText = time_string
                                                    }
                                                    let imgs = document.createElement('div')
                                                    let image2 = document.createElement('img')
                                                    image2.src = 'images/history.png'
                                                    if (access[2] == 1) {
                                                        let image1 = document.createElement('img')
                                                        image1.src = 'images/green.png'
                                                        image1.classList.add('image_unit', 'green_edit')
                                                        imgs.appendChild(image1)
                                                    }
                                                    image2.classList.add('image_unit', 'history_list_img')
                                                    let span = document.createElement('span')
                                                    span.textContent = main[i].id
                                                    span.style.display = "none"
                                                    span.classList.add('spann')
                                                    imgs.appendChild(image2)
                                                    cells[5].appendChild(span)
                                                    cells[5].appendChild(imgs)
                                                    imgs.classList.add('imgs')
                                                }
                                                let points = document.getElementsByClassName('listalka_point')
                                                for (let i = 0; i < points.length; i++)
                                                    if (points[i].classList.contains('listalka_point_color'))
                                                        points[i].classList.remove('listalka_point_color')
                                                e.target.classList.add('listalka_point_color')
                                            }
                                        })
                                    }
                                }

                                let but_throw = document.getElementsByClassName('but_filter_throw')[0]
                                but_throw.onclick = function () {
                                    filter_type.textContent = 'Тип происшествия'
                                    filter_post.value = ''
                                    filter_time.textContent = 'Время фиксации'
                                    filter_timeDone.textContent = 'Время устранения'
                                    filter_time.startTime = null
                                    filter_time.endTime = null
                                    filter_timeDone.startTime = null
                                    filter_timeDone.endTime = null
                                    document.getElementsByClassName('but_filter_apply')[0].click()
                                }

                                let but_apply = document.getElementsByClassName('but_filter_apply')[0]
                                but_apply.onclick = function () {
                                    let type_cod = null
                                    if (filter_type.textContent == 'Некомплектность')
                                        type_cod = 1
                                    if (filter_type.textContent == 'Авария')
                                        type_cod = 2
                                    if (filter_type.textContent == 'Травма')
                                        type_cod = 3
                                    if (filter_type.textContent == 'Другое')
                                        type_cod = 4
                                    let post_cod = null
                                    let time1 = null
                                    let time1end = null
                                    let time2 = null
                                    let time2end = null
                                    console.log(filter_post.value)
                                    if (filter_post.value)
                                        post_cod = filter_post.value
                                    console.log(filter_time)
                                    if (filter_time.textContent != 'Время фиксации') {
                                        time1 = filter_time.startTime
                                        time1end = filter_time.endTime
                                    }
                                    if (filter_timeDone.textContent != 'Время устранения') {
                                        time2 = filter_timeDone.startTime
                                        time2end = filter_timeDone.endTime
                                    }
                                    if (!(type_cod == null & post_cod == null & (time1 == null || time1end == null) && (time2 == null || time2end == null))) {

                                        new Promise((resolve, reject) => {
                                            xhr = new XMLHttpRequest()
                                            xhr.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'accidentfiltered');
                                            xhr.setRequestHeader("Content-Type", "application/json");
                                            xhr.addEventListener('load', () => {
                                                resolve(xhr.response)
                                            })
                                            xhr.addEventListener('error', () => {
                                                reject()
                                            })
                                            let data = JSON.stringify({
                                                "aTypeId": type_cod,
                                                "post": post_cod,
                                                "accidentdatefirst": time1,
                                                "accidentdatesecond": time1end,
                                                "accidentdatefirstend": time2,
                                                "accidentdatesecondend": time2end,
                                                "startprom": 1,
                                                "endprom": 10
                                            });
                                            xhr.send(data)
                                        }).then(text => {
                                            let divchik = document.getElementsByClassName('divchik')[1]
                                            let old_list = document.getElementsByTagName('table')[1]
                                            if (!document.body.getElementsByClassName('empty')[0]) {
                                                divchik.removeChild(old_list)
                                                document.body.removeChild(document.body.getElementsByClassName('listalka')[0])
                                            } else {
                                                document.body.removeChild(document.body.getElementsByClassName('empty')[0])
                                            }
                                            let main = JSON.parse(text)[1];
                                            let count_filtered = JSON.parse(text)[0]
                                            if (main.length != 0) {
                                                let divchik = document.getElementsByClassName('divchik')[1]
                                                let cap = document.createElement('table')
                                                divchik.appendChild(cap)

                                                let shapka = document.createElement('tr')
                                                cap.appendChild(shapka)
                                                shapka.classList.add('cap')
                                                let cell = document.createElement('th')
                                                cell.textContent = 'Номер поста'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cell = document.createElement('th')
                                                cell.textContent = 'Тип происшествия'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cell = document.createElement('th')
                                                cell.textContent = 'Описание'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cell = document.createElement('th')
                                                cell.textContent = 'Время фиксации происшествия'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cell = document.createElement('th')
                                                cell.textContent = 'Время устранения происшествия'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cell = document.createElement('th')
                                                cell.textContent = 'Изменить/Посмотреть изменения'
                                                cell.classList.add('cap_unit')
                                                shapka.appendChild(cell)
                                                cap.appendChild(shapka)
                                                //document.body.appendChild(cap)
                                                for (let i = 0; i < 10 && i < main.length; i++) {
                                                    let str = document.createElement('tr')
                                                    str.classList.add('row')
                                                    cap.appendChild(str)
                                                    let cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    cell = document.createElement('td')
                                                    cell.classList.add('row_unit')
                                                    str.appendChild(cell)
                                                    let rows = document.body.getElementsByTagName('tr')
                                                    let row = rows[rows.length - 1]
                                                    let cells = row.getElementsByTagName('td')
                                                    cells[0].textContent = main[i].post
                                                    if (main[i].atypeId)
                                                        cells[1].textContent = main[i].atypeId.name
                                                    cells[2].textContent = main[i].description
                                                    if (main[i].startTime != null) {
                                                        let time = new Date(main[i].startTime)
                                                        let secunds = Date.parse(time) + 10800000
                                                        time = new Date(secunds)
                                                        let month = time.getMonth() + 1
                                                        let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                                        cells[3].innerText = time_string
                                                    }
                                                    if (main[i].endTime != null) {
                                                        let time = new Date(main[i].endTime)
                                                        let secunds = Date.parse(time) + 10800000
                                                        time = new Date(secunds)
                                                        let month = time.getMonth() + 1
                                                        let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                                                        cells[4].innerText = time_string
                                                    }
                                                    let span = document.createElement('span')
                                                    span.textContent = main[i].id
                                                    span.style.display = "none"
                                                    span.classList.add('spann')
                                                    let imgs = document.createElement('div')
                                                    if (access[2] == 1) {
                                                        let image1 = document.createElement('img')
                                                        image1.src = 'images/green.png'
                                                        image1.classList.add('image_unit', 'green_edit')
                                                        imgs.appendChild(image1)
                                                    }
                                                    let image2 = document.createElement('img')
                                                    image2.src = 'images/history.png'
                                                    image2.classList.add('image_unit', 'history_list_img')
                                                    imgs.appendChild(image2)
                                                    cells[5].appendChild(span)
                                                    cells[5].appendChild(imgs)
                                                    imgs.classList.add('imgs')
                                                }
                                                let listalka = document.createElement('div')
                                                listalka.classList.add('listalka')
                                                document.body.appendChild(listalka)
                                                for (let i = 0; i < Math.ceil(count_filtered / 10); i++) {
                                                    let punkt = document.createElement('div')
                                                    punkt.classList.add('listalka_point')
                                                    punkt.textContent = i + 1
                                                    listalka.appendChild(punkt)
                                                }
                                                listalka = document.querySelector('.listalka_point')
                                                listalka.classList.add('listalka_point_color')
                                            } else {
                                                let empty = document.createElement('div')
                                                empty.innerText = 'Список пуст'
                                                document.body.appendChild(empty)
                                                empty.classList.add('empty')
                                            }

                                            let listalka = document.getElementsByClassName('listalka')[0]
                                            if (listalka) {
                                                listalka.onclick = (e) => {
                                                    numberOfListalka = e.target.textContent
                                                    fillingHelpingListalka(e.target)
                                                }
                                            }


                                            let but_deleteOrEdit_user = document.getElementsByTagName('table')[1]
                                            if (but_deleteOrEdit_user) {
                                                but_deleteOrEdit_user.addEventListener('click', function (event) {
                                                    if (event.target.classList.contains('green_edit')) {
                                                        console.log('редактирование')
                                                        let that = event.target
                                                        let nodes = document.body.getElementsByClassName('row')
                                                        let descriptionI
                                                        let typeI
                                                        let timeI
                                                        let timeDoneI
                                                        let postI
                                                        let idI
                                                        for (let i = 0; i < nodes.length; i++) {
                                                            if (that.parentNode.parentNode.parentNode == nodes[i]) {
                                                                typeI = nodes[i].children[1].textContent
                                                                objForMonEdit[0] = (typeI)
                                                                sessionStorage.setItem('typeI', typeI)
                                                                descriptionI = nodes[i].children[2].textContent
                                                                objForMonEdit[1] = (descriptionI)
                                                                sessionStorage.setItem('descriptionI', descriptionI)
                                                                timeI = nodes[i].children[3].textContent
                                                                objForMonEdit[2] = (timeI)
                                                                sessionStorage.setItem('timeI', timeI)
                                                                timeDoneI = nodes[i].children[4].textContent
                                                                objForMonEdit[3] = (timeDoneI)
                                                                sessionStorage.setItem('timeDoneI', timeDoneI)
                                                                postI = nodes[i].children[0].textContent
                                                                objForMonEdit[4] = (postI)
                                                                sessionStorage.setItem('postI', postI)

                                                                idI = nodes[i].children[5].getElementsByClassName('spann')[0].textContent
                                                                objForMonEdit[5] = (idI)
                                                                sessionStorage.setItem('idI', idI)
                                                            }
                                                        }
                                                        goToMonitoringEdit()
                                                        history.pushState({}, '', '#mon/edit')
                                                        document.title = 'Редактирование происшествия'
                                                        let inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                                                        let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                                                        let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                                                        let inp4 = document.body.getElementsByClassName('inp3')[0]
                                                        let span = document.createElement('span')
                                                        span.classList.add('spann')
                                                        span.textContent = idI
                                                        console.log(idI, typeI, postI)
                                                        span.style.display = "none"
                                                        document.body.appendChild(span)
                                                        inp1.textContent = postI
                                                        console.log(postI)
                                                        inp2.textContent = timeI
                                                        inp3.textContent = timeDoneI
                                                        inp4.value = descriptionI
                                                        let type = document.body.getElementsByClassName('inp2')[0].children
                                                        let flag = 0
                                                        for (let i = 0; i < 4; i++) {
                                                            if (typeI == type[i].textContent) {
                                                                type[i].style.background = 'black'
                                                                type[i].style.color = 'white'
                                                                flag = 1
                                                            }
                                                        }
                                                    }
                                                    if (event.target.classList.contains('history_list_img')) {
                                                        goToMonitoringHistory(event.target)
                                                        history.pushState({}, '', '#mon/history')
                                                        document.title = 'История происшествия'
                                                    }
                                                })
                                            }
                                        }).finally(() => {
                                            clearInterval(timerTablo)
                                            timerTablo = setInterval(() => {
                                                new Promise((resolve) => {
                                                    console.log('setInteval')
                                                    fillingTablo().then(() => {
                                                        console.log('первый этап прошёл')
                                                        resolve()
                                                    })
                                                }).then(() => {
                                                    let listalka = document.getElementsByClassName('listalka')[0]
                                                    if (listalka) {
                                                        if (!(filter_post.value == "" && filter_type.innerText.split('\n')[0] == 'Тип происшествия' && filter_time.innerText.split('\n')[0] == 'Время фиксации' && filter_timeDone.innerText.split('\n')[0] == 'Время устранения'))
                                                            fillingHelpingListalka(listalka.children[numberOfListalka - 1])
                                                    }
                                                })
                                            }, 3000)
                                        })
                                    } else {
                                        clearInterval(timerTablo)
                                        goToMonitoring();
                                        history.pushState({}, '', '#mon')
                                        document.title = 'Мониторинг'
                                    }
                                }
                            })
                        })
                    }
                })

                logout.addEventListener('click', function () {
                    window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                    sessionStorage.removeItem('page')
                })

                admin.onclick = () => {
                    if (access[0] == 1) {
                        goToAdmin()
                        history.pushState({}, '', '#adm')
                        document.title = 'Администрирование'
                    } else {
                        goToProhibit()
                        history.pushState({}, '', '#access')
                        document.title = 'Нет доступа'
                    }
                }
            }).finally(() => {
                timerTablo = setInterval(() => {
                    new Promise((resolve) => {
                        console.log('setInteval')
                        fillingTablo().then(() => {
                            console.log('первый этап прошёл')
                            resolve()
                        })
                    }).then(() => {
                        let listalka = document.getElementsByClassName('listalka')[0]
                        if (listalka) {
                            if ((filter_post.value == "" && filter_type.innerText.split('\n')[0] == 'Тип происшествия' && filter_time.innerText.split('\n')[0] == 'Время фиксации' && filter_timeDone.innerText.split('\n')[0] == 'Время устранения'))
                                fillingHelpingListalka(listalka.children[numberOfListalka - 1])
                        }
                    })
                }, 3000)
            })
        }


        function goToMonitoringEdit() {
            sessionStorage.setItem('page', 'mon/edit')
            clearInterval(timerTablo)
            let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
            document.body.innerHTML = inner;
            name_logout.textContent = nickName
            let cur_menu = document.getElementById('monitor');
            cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
            let name_menu = '<div class="name_menu">Редактирование происшествия</div>'
            document.body.innerHTML += name_menu;
            let horiz_line = '<div class="horiz_line"></div>'
            document.body.innerHTML += horiz_line;
            let inp1 = document.createElement('div')
            inp1.classList.add('inp1')
            document.body.appendChild(inp1)
            let row = '<div class="inp1_names"><div class="inp1_name1">Номер поста</div><div class="inp1_name2">Время фиксации проблемы</div><div class="inp1_name3">Время устранения проблемы</div></div>'
            inp1.innerHTML += row
            row = '<div class="inp1_inputs"><div class="inp1_input1"></div><div class="inp1_input2"></div><div class="inp1_input3"></div></div>'
            inp1.innerHTML += row
            document.body.innerHTML += '<div class="menu_type_problem">Тип происшествия</div>'
            document.body.innerHTML += '<div class="inp2"><div class="inp2_unit1">Некомплектность</div><div class="inp2_unit2">Авария</div><div class="inp2_unit3">Травма</div><div class="inp2_unit4">Другое</div></div>'
            document.body.innerHTML += '<div class="menu_type_problem">Описание</div>'
            document.body.innerHTML += '<input class="inp3" placeholder="Описание происшествия">'
            let safe_button = '<a class="safe_button">Сохранить</a>'
            document.body.innerHTML += safe_button;
            let cancel_button = '<a class="cancel_button">Отмена</a>'
            document.body.innerHTML += cancel_button;
            let inp2 = document.body.getElementsByClassName('inp2')[0]
            inp2.onclick = (e) => {
                let th = e.target
                let children = e.target.parentNode.children
                for (let i = 0; i < children.length; i++) {
                    children[i].style.background = "white"
                    children[i].style.color = "black"
                }
                th.style.background = "black"
                th.style.color = "white"
            }

            /*----------------------------------------------------------------------------------*/

            logout.addEventListener('click', function () {
                window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                sessionStorage.removeItem('page')
            })

            admin.onclick = () => {
                if (access[0] == 1) {
                    goToAdmin()
                    history.pushState({}, '', '#adm')
                    document.title = 'Администрирование'
                } else {
                    goToProhibit()
                    history.pushState({}, '', '#access')
                    document.title = 'Нет доступа'
                }
            }
            monitor.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }
            let cancel = document.body.getElementsByClassName('cancel_button')[0]
            cancel.onclick = () => {
                goToMonitoring()
                history.pushState({}, '', '#mon')
                document.title = 'Мониторинг'
            }
            let safe = document.body.getElementsByClassName('safe_button')[0]
            safe.onclick = () => {

                let inm = document.getElementsByClassName('mismatch')[0]
                if (inm) {
                    document.body.removeChild(inm)
                }

                let inp4 = document.body.getElementsByClassName('inp3')[0]
                let type = document.body.getElementsByClassName('inp2')[0].children
                let id = document.body.getElementsByClassName('spann')[0].textContent
                let t
                for (let i = 0; i < 4; i++) {
                    if (type[i].style.background == 'black') {
                        t = type[i].textContent
                    }
                }
                if (t == 'Некомплектность')
                    t = 1
                if (t == 'Авария')
                    t = 2
                if (t == 'Травма')
                    t = 3
                if (t == 'Другое')
                    t = 4
                let req8
                if (inp4.value.length > 256) {
                    let inm = document.getElementsByClassName('inp3')[0]
                    if (!inm.children[0]) {
                        let er = document.createElement('div')
                        er.classList.add('mismatch')
                        er.style.marginLeft = '10%'
                        document.body.insertBefore(er, document.getElementsByClassName('safe_button')[0])
                        er.textContent = 'Длина должна быть не больше 256 символов'
                    }
                } else {
                    new Promise((resolve, reject) => {
                        req8 = new XMLHttpRequest()
                        req8.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'updateaccidents');
                        req8.setRequestHeader("Content-Type", "application/json");
                        req8.addEventListener('load', () => {
                            resolve(req8.response)
                        })
                        req8.addEventListener('error', () => {
                            reject(alert('Не удалось изменить происшествие'))
                        })
                        let data = JSON.stringify({"aTypeId": t, "id": id, "description": inp4.value});
                        req8.send(data)
                    }).then(() => {
                        alert('Происшествие было изменено')
                        goToMonitoring()
                        history.pushState({}, '', '#mon')
                        document.title = 'Мониторинг'
                    })
                }
            }
        }


        function goToMonitoringHistory(target) {
            sessionStorage.setItem('page', 'mon/history')
            clearInterval(timerTablo)
            let nodes = document.body.getElementsByClassName('row')
            let idk
            if (typeof target == 'string') {
                if (objForMonHistory)
                    idk = objForMonHistory
                else {
                    idk = sessionStorage.getItem('monHistory')
                }
            } else {
                for (let i = 0; i < nodes.length; i++) {
                    if (target.parentNode.parentNode.parentNode == nodes[i]) {
                        idk = nodes[i].children[5].getElementsByClassName('spann')[0].textContent
                        objForMonHistory = idk
                        sessionStorage.setItem('monHistory', idk)
                    }
                }
            }
            new Promise((resolve, reject) => {
                req8 = new XMLHttpRequest()
                req8.open('POST', location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'getpreviusstates');
                req8.setRequestHeader("Content-Type", "application/json");
                req8.addEventListener('load', () => {
                    resolve(req8.response)
                })
                req8.addEventListener('error', () => {
                    reject()
                })
                var data = JSON.stringify({"id": idk});
                req8.send(data)
            }).then(text => {
                let main = JSON.parse(text);
                let inner = ('<div class="nav_upper"><div class="upper_left"><div class="upper_unit" id="monitor">Мониторинг</div><div class="upper_unit" id="admin">Администрирование</div></div><div class="upper_right"><div id="name_logout"></div><img id="logout" src="images/logout.png"></div></div>')
                document.body.innerHTML = inner;
                name_logout.textContent = nickName
                let cur_menu = document.getElementById('monitor');
                cur_menu.style.background = 'rgba(255, 255, 255, 0.66)';
                let name_menu = '<div class="name_menu">История редактирования происшествия</div>'
                document.body.innerHTML += name_menu;
                let horiz_line = '<div class="horiz_line"></div>'
                document.body.innerHTML += horiz_line;
                let inp1 = document.createElement('div')
                inp1.classList.add('inp1')
                document.body.appendChild(inp1)
                let row = '<div class="inp1_names"><div class="inp1_name1">Номер поста</div><div class="inp1_name2">Время фиксации проблемы</div><div class="inp1_name3">Время устранения проблемы</div></div>'
                inp1.innerHTML += row
                row = '<div class="inp1_inputs"><div class="inp1_input1"></div><div class="inp1_input2"></div><div class="inp1_input3"></div></div>'
                inp1.innerHTML += row
                inp1 = document.body.getElementsByClassName('inp1_input1')[0]
                let inp2 = document.body.getElementsByClassName('inp1_input2')[0]
                let inp3 = document.body.getElementsByClassName('inp1_input3')[0]
                inp1.textContent = main.post
                if (main.startTime != null) {
                    let time = new Date(main.startTime)
                    let secunds = Date.parse(time) + 10800000
                    time = new Date(secunds)
                    let month = time.getMonth() + 1
                    let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                    inp2.textContent = time_string
                }

                let x = main;
                while (x.nextVersionId != null) {
                    x = x.nextVersionId;
                }
                if (x.endTime != null) {
                    let time = new Date(x.endTime)
                    let secunds = Date.parse(time) + 10800000
                    time = new Date(secunds)
                    let month = time.getMonth() + 1
                    let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                    inp3.textContent = time_string
                }
                let return_mon = document.createElement('div')
                return_mon.textContent = 'Возврат к мониторингу'
                return_mon.classList.add('return_mon')
                document.body.appendChild(return_mon)

                let divchik = document.createElement('div')
                divchik.classList.add('divchik')
                document.body.appendChild(divchik)
                let cap = '<table><tr class="cap"><th class="cap_unit">Тип происшествия</th><th class="cap_unit">Описание</th><th class="cap_unit">Пользователь</th><th class="cap_unit">Дата и время</th></tr></table>'
                divchik.innerHTML += cap
                let table = document.body.getElementsByTagName('table')[0]
                let array = []
                if (main.atypeId != null)
                    array.push({
                        'type': main.atypeId.name,
                        'description': main.description,
                        'user': main.username,
                        'time': main.timestamp
                    })
                else
                    array.push({
                        'type': null,
                        'description': main.description,
                        'user': main.username,
                        'time': main.timestamp
                    })
                while (main.nextVersionId != null) {
                    main = main.nextVersionId
                    if (main.atypeId != null)
                        array.push({
                            'type': main.atypeId.name,
                            'description': main.description,
                            'user': main.username,
                            'time': main.timestamp
                        })
                    else
                        array.push({
                            'type': null,
                            'description': main.description,
                            'user': main.username,
                            'time': main.timestamp
                        })
                }


                if (array.length != 0) {
                    for (let i = array.length - 1; i > -1; i--) {
                        console.log(i)
                        let row = '<tr class="row"><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td><td class="row_unit"></td></tr>'
                        table.innerHTML += row
                        let rows = document.body.getElementsByTagName('tr')
                        row = rows[rows.length - 1]
                        let cells = row.getElementsByTagName('td')
                        cells[0].innerText = array[i].type
                        cells[1].innerText = array[i].description
                        cells[2].innerText = array[i].user
                        if (array[i].time != null) {
                            let time = new Date(array[i].time)
                            let secunds = Date.parse(time) + 10800000
                            time = new Date(secunds)
                            let month = time.getMonth() + 1
                            let time_string = time.getDate() + '.' + month + '.' + time.getFullYear() + ' ' + (time.getHours()) + ':' + time.getMinutes() + ':' + time.getSeconds()
                            cells[3].innerText = time_string
                        }
                    }
                }

            }).finally(() => {
                let tabl = document.getElementsByTagName('table')[0]
                tabl.style.marginBottom = '50px'

                logout.addEventListener('click', function () {
                    window.location.replace(location.protocol + '//' + location.host + location.pathname + (location.search ? location.search : "") + 'logout');
                    sessionStorage.removeItem('page')
                })

                let button = document.getElementsByClassName('return_mon')[0]
                button.onclick = () => {
                    goToMonitoring()
                    history.pushState({}, '', '#mon')
                    document.title = 'Мониторинг'
                }

                let admin = document.getElementById('admin')
                admin.onclick = () => {
                    if (access[0] == 1) {
                        goToAdmin()
                        history.pushState({}, '', '#adm')
                        document.title = 'Администрирование'
                    } else {
                        goToProhibit()
                        history.pushState({}, '', '#access')
                        document.title = 'Нет доступа'
                    }
                }

                let monitoring = document.getElementById('monitor')
                monitoring.onclick = () => {
                    goToMonitoring()
                    history.pushState({}, '', '#mon')
                    document.title = 'Мониторинг'
                }
            })
        }

    </script>
</head>
<body className="container" id="cont">
</body>
</html>
